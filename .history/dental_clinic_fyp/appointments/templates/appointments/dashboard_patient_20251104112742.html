{% extends "users/base.html" %}
{% load static %}
{% block title %}Book Appointment{% endblock %}

{% block content %}

<h2>Book an Appointment</h2>

<form method="post" action="{% url 'appointments:create_appointment' %}">
    {% csrf_token %}
    <div class="mb-3">
        <label>Choose a Doctor:</label>
        <select id="doctor-select" name="doctor" class="form-control" required>
            <option value="" selected disabled>Select a Doctor</option>
            {% for doctor in doctors %}
                <option value="{{ doctor.id }}"
                    data-degree="{{ doctor.degree }}"
                    data-specialization="{{ doctor.specialization }}"
                    data-experience="{{ doctor.experience_years }}"
                    data-bio="{{ doctor.bio }}"
                    data-pic-url="{{ doctor.profile_pic_url }}">
                    {{ doctor.full_name }}
                </option>
            {% endfor %}
        </select>
    </div>

    <!-- Doctor Profile Preview -->
    <div id="doctor-profile" style="border:1px solid #ccc; padding:15px; margin-top:10px; border-radius:8px; display:none;">
        <img id="doc-pic" src="" alt="Doctor Picture" style="width:120px; height:120px; border-radius:50%; object-fit:cover;">
        <p id="doc-degree"></p>
        <p id="doc-specialization"></p>
        <p id="doc-experience"></p>
        <p id="doc-bio"></p>
    </div>

    <!-- Appointment Date & Time -->
    <div class="mb-3">
        <label>Appointment Date</label>
        <input type="date" name="date" class="form-control" required id="appointment-date">
    </div>
    <div class="mb-3">
        <label>Appointment Time</label>
        <input type="time" name="time" class="form-control" required min="09:00" max="18:00" id="appointment-time">
        <small>Appointments allowed only between 9:00 AM and 6:00 PM</small>
    </div>

    <div class="mb-3">
        <label>Notes</label>
        <textarea name="notes" class="form-control" rows="2"></textarea>
    </div>

    <button type="submit" class="btn btn-primary">Book Appointment</button>
</form>

<script>
const select = document.getElementById('doctor-select');
const profileDiv = document.getElementById('doctor-profile');
const pic = document.getElementById('doc-pic');
const degree = document.getElementById('doc-degree');
const specialization = document.getElementById('doc-specialization');
const experience = document.getElementById('doc-experience');
const bio = document.getElementById('doc-bio');

select.addEventListener('change', () => {
    const option = select.selectedOptions[0];
    pic.src = option.dataset.picUrl || '/static/images/default_profile.png';
    degree.innerText = "Degree: " + (option.dataset.degree || 'N/A');
    specialization.innerText = "Specialization: " + (option.dataset.specialization || 'N/A');
    experience.innerText = "Experience: " + (option.dataset.experience || '0') + " years";
    bio.innerText = "Bio: " + (option.dataset.bio || 'Not available');
    profileDiv.style.display = 'block';
});
</script>

{% endblock %}
