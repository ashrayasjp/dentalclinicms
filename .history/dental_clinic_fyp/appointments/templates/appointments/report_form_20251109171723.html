<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Report for {{ appointment.patient.user.get_full_name|default:appointment.patient.user.username }}</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@600;700&family=Nunito+Sans:wght@600;700&display=swap" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #e7ffff;
        }

        .report-header {
            background-color: #007bff;
            color: white;
            padding: 15px 20px;
            border-radius: 12px 12px 0 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 10px;
        }

        .report-header h2 {
            margin: 0;
            font-weight: 700;
        }

        .report-header p {
            margin: 2px 0 0;
            font-size: 0.9rem;
        }

        .report-card {
            background-color: #E6F3FF;
            padding: 25px 30px;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 4px 15px rgba(0,123,255,0.15);
            border-top: 3px solid #007bff;
        }

        .form-label {
            font-weight: 600;
        }

        canvas {
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <div class="container mt-5" style="max-width: 700px;">

        <!-- Header Section -->
        <div class="report-header">
            <h2>Dental Report</h2>
            <p>Patient: <strong>{{ appointment.patient.user.get_full_name|default:appointment.patient.user.username }}</strong></p>
            <p>Doctor: <strong>{{ appointment.doctor.user.get_full_name }}</strong></p>
        </div>

        <!-- Form Card -->
        <div class="report-card">
            <form method="post" style="display: flex; flex-direction: column; gap: 18px;">
                {% csrf_token %}

                <!-- Patient Info -->
                <div style="display: flex; flex-direction: row; gap: 10px; align-items: center;">
                    <label class="form-label" style="width: 150px;">Patient Name:</label>
                    <input type="text" class="form-control" value="{{ appointment.patient.user.get_full_name }}" readonly 
                           style="flex: 1; border-radius: 6px; padding: 8px; color: #0b3d91; font-weight: 500;">
                </div>

                <!-- Doctor-editable Fields -->
                <div style="display: flex; flex-direction: row; gap: 10px; align-items: flex-start;">
                    <label class="form-label" style="width: 150px;">Diagnosis:</label>
                    <div style="flex: 1;">{{ form.diagnosis }}</div>
                </div>

                <div style="display: flex; flex-direction: row; gap: 10px; align-items: flex-start;">
                    <label class="form-label" style="width: 150px;">Prescription:</label>
                    <div style="flex: 1;">{{ form.prescription }}</div>
                </div>

                <div style="display: flex; flex-direction: row; gap: 10px; align-items: flex-start;">
                    <label class="form-label" style="width: 150px;">Notes:</label>
                    <div style="flex: 1;">{{ form.notes }}</div>
                </div>

                <div style="display: flex; flex-direction: row; gap: 10px; align-items: center;">
                    <label class="form-label" style="width: 150px;">Follow-up Date:</label>
                    <div style="flex: 1;">{{ form.follow_up_date }}</div>
                </div>

                <div style="display: flex; flex-direction: row; gap: 10px; align-items: flex-start;">
                    <label class="form-label" style="width: 150px;">Follow-up Notes:</label>
                    <div style="flex: 1;">{{ form.follow_up_notes }}</div>
                </div>

                <!-- Signature Pad -->
                <div style="margin-top: 15px;">
                    <label style="font-weight:600;">Doctor Signature:</label>
                    <canvas id="signature-pad" width="600" height="200" style="border:1px solid #ccc; width:100%;"></canvas>
                    <button type="button" id="clear-signature" class="btn btn-outline-secondary btn-sm mt-2">Clear</button>
                    {{ form.signature }}
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn btn-primary mt-3">Save Report</button>
            </form>
        </div>
    </div>

<!-- Signature Pad JS -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
<script>
const canvas = document.getElementById('signature-pad');
const signaturePad = new SignaturePad(canvas);

// Clear signature button
document.getElementById('clear-signature').addEventListener('click', () => {
    signaturePad.clear();
});

// Save signature to hidden input before submitting
document.querySelector('form').addEventListener('submit', () => {
    if (!signaturePad.isEmpty()) {
        document.getElementById('{{ form.signature.id_for_label }}').value = signaturePad.toDataURL();
    }
});
</script>  