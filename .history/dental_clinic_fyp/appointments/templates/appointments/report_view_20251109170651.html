{% extends "users/base.html" %}
{% block title %}Report for {{ appointment.patient.user.username }}{% endblock %}

{% block content %}
<div class="container mt-4" style="max-width: 700px;">

    <!-- Action Buttons -->
    <div class="mb-3 d-flex justify-content-end gap-2">
        <!-- Print Button -->
        <button class="btn btn-primary" onclick="window.print()">
            üñ®Ô∏è Print
        </button>

        <!-- Download PDF Button -->
        <button class="btn btn-success">
            üìÑ Download
        </button>
    </div>

    <!-- Report Content -->
    <div id="report-content" style="background-color: #f8f9fa; padding: 30px; border-radius: 12px; border: 1px solid #dee2e6; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);">
        <h3 style="color: #0d6efd; font-weight: 700; border-left: 6px solid #0d6efd; padding-left: 12px; margin-bottom: 20px;">
            Report for {{ appointment.patient.user.get_full_name|default:appointment.patient.user.username }}
        </h3>

        <!-- Patient Details -->
        <p><strong>Patient Name:</strong> {{ appointment.patient.user.get_full_name }}</p>
        <p><strong>Blood Group:</strong> {{ appointment.patient.user.blood_group }}</p>
        <p><strong>Age:</strong> {{ appointment.patient.age }}</p>
        <p><strong>Gender:</strong> {{ appointment.patient.gender }}</p>

        <hr style="border-top: 1px solid #dee2e6;">

        <!-- Report Details -->
        <p><strong>Diagnosis:</strong> {{ report.diagnosis|default:"-" }}</p>
        <p><strong>Prescription:</strong> {{ report.prescription|default:"-" }}</p>
        <p><strong>Notes:</strong> {{ report.notes|default:"-" }}</p>
        <p><strong>Follow-up Date:</strong> {{ report.follow_up_date|date:"M d, Y"|default:"-" }}</p>
        <p><strong>Follow-up Notes:</strong> {{ report.follow_up_notes|default:"-" }}</p>
        <p><strong>Created At:</strong> {{ report.created_at|date:"M d, Y H:i" }}</p>
        <p><strong>Last Updated:</strong> {{ report.updated_at|date:"M d, Y H:i" }}</p>

        <hr style="border-top: 1px solid #dee2e6; margin-top: 40px;">

        {% if report.signature %}
        <div style="display: flex; flex-direction: column; align-items: flex-start; gap: 10px; margin-top: 20px;">
            <p><strong>{{ appointment.doctor.user.get_full_name }}</strong></p>
            <img src="{{ report.signature }}" alt="Doctor Signature" style="border:1px solid #ccc; max-width:300px; display:block;">
            <p style="font-weight:600;">Doctor Signature</p>
        </div>
        {% else %}
        <p><em>Doctor signature not available yet.</em></p>
        {% endif %}

    </div>
</div>

<!-- Print-specific CSS -->
<style>
@media print {
    body * {
        visibility: hidden;
    }
    #report-content, #report-content * {
        visibility: visible;
    }
    #report-content {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        box-shadow: none;
    }
    button {
        display: none;
    }
}

/* Professional button styles */
.btn-primary {
    background-color: #0d6efd;
    border: none;
    font-weight: 500;
    transition: all 0.2s ease;
}
.btn-primary:hover {
    background-color: #0b5ed7;
    transform: translateY(-1px);
}

.btn-success {
    background-color: #198754;
    border: none;
    font-weight: 500;
    transition: all 0.2s ease;
}
.btn-success:hover {
    background-color: #157347;
    transform: translateY(-1px);
}
</style>
{% endblock %}
