{% extends "users/base.html" %}
{% block title %}Welcome to Dental Clinic{% endblock %}
{% load static %}

{% block content %}
{% if messages %}
  {% for message in messages %}
    <div class="alert 
        {% if message.tags %}alert-{{ message.tags }}{% else %}alert-info{% endif %} 
        alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endfor %}
{% endif %}

<div class="container text-center mt-5">
    <h1>Welcome to CrystalSmile Dental</h1>
    <p style="font-size:1.1rem; color:#555;">Your oral health is our priority.</p>
</div>

<!-- Our Services Section -->
<div class="container mt-5">
    <h2>Our Services</h2>
    <div class="row row-cols-1 row-cols-md-3 g-4" id="services-section" style="display:none;">
        {% comment %} Service Cards {% endcomment %}
        {% for service in [
            {'img':'teeth_cleaning.jpg','title':'Teeth Cleaning','desc':'Professional teeth cleaning to remove plaque and maintain oral hygiene.','price':'800'},
            {'img':'tooth_whitening.jpg','title':'Tooth Whitening','desc':'Brighten your smile with safe and effective whitening treatments.','price':'1500'},
            {'img':'filling.jpg','title':'Dental Filling','desc':'Restore decayed teeth with high-quality fillings for durability and comfort.','price':'1200'},
            {'img':'braces.jpg','title':'Braces','desc':'Correct misaligned teeth with custom braces for a confident smile.','price':'25000'},
            {'img':'root_canal.jpg','title':'Root Canal Treatment','desc':'Relieve pain and save your tooth with professional root canal therapy.','price':'5000'},
            {'img':'dental_implant.jpg','title':'Dental Implant','desc':'Permanent tooth replacement to restore function and aesthetics.','price':'35000'},
        ] %}
        <div class="col">
            <div class="card h-100 shadow-sm service-card">
                <img src="{% static 'images/' %}{{ service.img }}" class="card-img-top" alt="{{ service.title }}">
                <div class="card-body">
                    <h5 class="card-title">{{ service.title }}</h5>
                    <p class="card-text">{{ service.desc }}</p>
                </div>
                <div class="card-footer text-center">
                    Rs. {{ service.price }}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Doctor Selection -->
<div class="container mt-5">
    <div class="mb-3">
        <label style="font-weight:600;color:#002f5f;">Select Doctor</label>
        <select class="form-control" id="doctor-select" required>
            <option value="">-- Choose a Doctor --</option>
            {% for doctor in doctors %}
                <option value="{{ doctor.id }}">{{ doctor.full_name }}</option>
            {% endfor %}
        </select>
        <input type="hidden" name="doctor" id="selected-doctor">
    </div>

    <!-- Doctor Details -->
    <div id="doctor-details" style="display:none; margin-top:20px; border:1px solid #ddd; padding:15px; border-radius:10px;">
        <div class="text-center mb-3">
            <img id="doc-profile" src="" alt="Profile Picture" style="width:150px; height:150px; border-radius:50%; object-fit:cover; border:3px solid #007B7F;">
        </div>
        <h4 id="doc-name" class="text-primary text-center mb-2"></h4>
        <p><strong>Degree:</strong> <span id="doc-degree"></span></p>
        <p><strong>Specialization:</strong> <span id="doc-specialization"></span></p>
        <p><strong>Experience:</strong> <span id="doc-experience"></span> years</p>
        <p><strong>Bio:</strong> <span id="doc-bio"></span></p>
    </div>
</div>

<!-- Our Doctors Section -->
<div class="container mt-5" id="doctors-section" style="opacity:0;">
    <h2>Our Doctors</h2>
    <div class="row row-cols-1 row-cols-md-3 g-4" id="doctors-container">
        <!-- JS will populate doctor cards here -->
    </div>
</div>

<!-- Footer -->
<footer id="footer-section" style="background:#007B7F; color:white; padding:50px 20px; margin-top:50px; display:none;">
    <div class="row">
        <!-- About & Map -->
        <div class="col-md-6 mb-4">
            <h5 style="font-weight:700;">About Us</h5>
            <p>We are committed to providing the best dental care for you and your family. Reach out anytime for inquiries, appointments, or guidance on oral health.</p>
            <h5 style="font-weight:700; margin-top:20px; margin-bottom:15px;">Our Location</h5>
            <div style="width: 100%; height: 250px; border-radius:12px; overflow:hidden; box-shadow:0 4px 10px rgba(0,0,0,0.2);">
                <iframe 
                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3532.7761952771157!2d85.31854881185906!3d27.693311276091404!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x39eb19b032e93fc1%3A0x4a61dc499d928027!2sSt.%20Xavier%27s%20College!5e0!3m2!1sen!2snp!4v1760898158288!5m2!1sen!2snp" 
                    width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
        </div>

        <!-- Contact Image -->
        <div class="col-md-6 text-center">
            <img src="{% static 'images/room.jpg' %}" style="max-width:100%; border:2px solid red; border-radius:12px;">
        </div>
    </div>
    <hr style="border-color: rgba(255,255,255,0.3);">
    <div class="text-center">&copy;2025 CrystalSmile Dental Clinic. All rights reserved.</div>
</footer>

<style>
    h1 { font-family: 'Calibri'; font-size: 3rem; color: #0B0047; font-weight: 700; text-shadow: 1px 1px 4px rgba(0,0,0,0.1); }
    h2 { font-family: 'Nunito Sans', sans-serif; font-size: 2rem; font-weight:700; color:#FF4040; text-transform:uppercase; letter-spacing:1px; border-bottom:3px solid #00a2e2; display:inline-block; padding-bottom:6px; margin:25px auto 40px auto; text-align:center; }
    .card-title { text-shadow:1px 1px 3px rgba(0,123,127,0.3); }
    #services-section .service-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,123,127,0.3); }
</style>

<script>
window.addEventListener('load', function() {
    // Fade in Services
    const services = document.getElementById('services-section');
    services.style.display = 'flex'; services.style.opacity=0;
    let op=0;
    const fade = setInterval(() => { if(op>=1){ clearInterval(fade); } services.style.opacity=op; op+=0.05; }, 50);

    // Fade in Footer
    const footer = document.getElementById('footer-section');
    footer.style.display='block'; footer.style.opacity=0;
    let fop=0;
    const fadeFooter = setInterval(()=>{ if(fop>=1){ clearInterval(fadeFooter); } footer.style.opacity=fop; fop+=0.05; },30);
});

// Doctor Selection Details
const doctorsData = {
    {% for doctor in doctors %}
    {{ doctor.id }}: {
        full_name: "{{ doctor.full_name|escapejs }}",
        degree: "{{ doctor.degree|default:'N/A'|escapejs }}",
        specialization: "{{ doctor.specialization|default:'N/A'|escapejs }}",
        experience_years: "{{ doctor.experience_years|default:'0' }}",
        bio: "{{ doctor.bio|default:'N/A'|escapejs }}",
        profile_picture: "{{ doctor.profile_picture|default:'/static/images/default_profile.png' }}"
    }{% if not forloop.last %},{% endif %}
    {% endfor %}
};

const select = document.getElementById('doctor-select');
select.addEventListener('change', function() {
    const docId = this.value;
    const detailsTab = document.getElementById('doctor-details');
    if(!docId){ detailsTab.style.display='none'; document.getElementById('selected-doctor').value=''; return; }
    const doc = doctorsData[docId];
    document.getElementById('selected-doctor').value = docId;
    document.getElementById('doc-name').textContent = doc.full_name;
    document.getElementById('doc-degree').textContent = doc.degree;
    document.getElementById('doc-specialization').textContent = doc.specialization;
    document.getElementById('doc-experience').textContent = doc.experience_years;
    document.getElementById('doc-bio').textContent = doc.bio;
    document.getElementById('doc-profile').src = doc.profile_picture;
    detailsTab.style.display='block';
});

// Fetch and display all doctors cards dynamically
async function fetchDoctors() {
    try {
        const response = await fetch("{% url 'appointments:all_doctors' %}");
        if(!response.ok) throw new Error("Network response was not ok");
        const doctors = await response.json();
        const container = document.getElementById('doctors-container');
        container.innerHTML = '';
        if(doctors.length===0){ container.innerHTML="<p class='text-center'>No doctors found.</p>"; return; }
        doctors.forEach(doc=>{
            const col=document.createElement('div'); col.className='col';
            const card=document.createElement('div'); card.className='card h-100 shadow-sm'; card.style.border='1px solid #000'; card.style.borderRadius='12px'; card.style.padding='20px'; card.style.textAlign='center'; card.style.transition='transform 0.3s, box-shadow 0.3s';
            card.innerHTML=`
                <img src="${doc.profile_picture}" alt="${doc.full_name}" style="width:150px;height:150px;border-radius:50%;object-fit:cover;margin-bottom:10px;border:3px solid #007B7F;">
                <h5 class="text-primary fw-bold mb-2">${doc.full_name}</h5>
                <p><strong>Degree:</strong> ${doc.degree}</p>
                <p><strong>Specialization:</strong> ${doc.specialization}</p>
                <p><strong>Experience:</strong> ${doc.experience_years} years</p>
                <p><strong>Bio:</strong> ${doc.bio}</p>
            `;
            col.appendChild(card); container.appendChild(col);
            card.addEventListener('mouseover',()=>{ card.style.transform='translateY(-5px)'; card.style.boxShadow='0 10px 25px rgba(0,123,127,0.3)'; });
            card.addEventListener('mouseout',()=>{ card.style.transform='translateY(0)'; card.style.boxShadow='0 4px 10px rgba(0,0,0,0.1)'; });
        });
        // Fade in doctors section
        const docSection=document.getElementById('doctors-section'); let op=0;
        const fade=setInterval(()=>{ if(op>=1){clearInterval(fade);} docSection.style.opacity=op; op+=0.05; },50);
    } catch(error){ console.error(error); document.getElementById('doctors-container').innerHTML="<p class='text-center'>Failed to load doctors.</p>"; }
}
document.addEventListener('DOMContentLoaded', fetchDoctors);
</script>

{% endblock %}
