{% extends 'users/base.html' %}
{% block content %}
<div class="card shadow-lg p-4 mx-auto mt-5" style="max-width:600px; border: 2px solid black; border-radius: 16px;">
  {% if messages %}
  {% for message in messages %}
    <div class="alert 
      {% if message.tags %}
        {% if message.tags == 'error' %}alert-danger
        {% elif message.tags == 'success' %}alert-success
        {% else %}alert-info{% endif %}
      {% else %}
        alert-info
      {% endif %} 
      alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endfor %}
{% endif %}

  <!-- Header section -->
  <div class="header-section text-center mb-4">
    <h4 style="letter-spacing: 0.5px; color:black; margin-bottom:0px;">
      Please enter your details
    </h4>
  </div>

  <form id="registerForm" method="post" action="{% url 'register' %}" enctype="multipart/form-data" class="form-area p-3 rounded">
    {% csrf_token %}

    <!-- Username -->
    <div class="mb-3">
      <label>Username</label>
      <input type="text" class="form-control" name="username" required value="{{ form_data.username|default:'' }}">
    </div>

    <!-- First and Last Name -->
    <div class="row">
      <div class="col mb-3">
        <label>First Name</label>
        <input type="text" class="form-control" name="first_name" required value="{{ form_data.first_name|default:'' }}">
      </div>
      <div class="col mb-3">
        <label>Last Name</label>
        <input type="text" class="form-control" name="last_name" required value="{{ form_data.last_name|default:'' }}">
      </div>
    </div>

    <!-- Email -->
    <div class="mb-3">
      <label>Email</label>
      <input type="email" class="form-control" name="email" required value="{{ form_data.email|default:'' }}">
    </div>

    <!-- Contact -->
    <div class="mb-3">
      <label>Phone Number</label>
      <input type="text" class="form-control" name="contact" required value="{{ form_data.contact|default:'' }}">
    </div>

    <!-- Blood Group -->
    <div class="mb-3">
      <label>Blood Group</label>
      <select class="form-select" name="blood_group" required>
        <option value="">Select...</option>
        <option value="A+" {% if form_data.blood_group|default:'' == "A+" %}selected{% endif %}>A+</option>
        <option value="A-" {% if form_data.blood_group|default:'' == "A-" %}selected{% endif %}>A-</option>
        <option value="B+" {% if form_data.blood_group|default:'' == "B+" %}selected{% endif %}>B+</option>
        <option value="B-" {% if form_data.blood_group|default:'' == "B-" %}selected{% endif %}>B-</option>
        <option value="AB+" {% if form_data.blood_group|default:'' == "AB+" %}selected{% endif %}>AB+</option>
        <option value="AB-" {% if form_data.blood_group|default:'' == "AB-" %}selected{% endif %}>AB-</option>
        <option value="O+" {% if form_data.blood_group|default:'' == "O+" %}selected{% endif %}>O+</option>
        <option value="O-" {% if form_data.blood_group|default:'' == "O-" %}selected{% endif %}>O-</option>
        
      </select>
    </div>

    <!-- Gender and Age Row -->
    <div class="row">
      <div class="col mb-3">
        <label>Gender</label>
        <select class="form-select" name="gender" required>
          <option value="">Select Gender</option>
          <option value="Male" {% if form_data.gender|default:'' == "Male" %}selected{% endif %}>Male</option>
          <option value="Female" {% if form_data.gender|default:'' == "Female" %}selected{% endif %}>Female</option>
          <option value="Other" {% if form_data.gender|default:'' == "Other" %}selected{% endif %}>Other</option>
          
        </select>
      </div>
      <div class="col mb-3">
        <label>Age</label>
        <input type="number" class="form-control" name="age" required value="{{ form_data.age|default:'' }}">
      </div>
    </div>

    <!-- Address -->
    <div class="mb-3">
      <label>Address</label>
      <input type="text" class="form-control" name="address" value="{{ form_data.address|default:'' }}">
    </div>

    <!-- Password -->
    <div class="row">
      <div class="col mb-3">
        <label>Password</label>
        <input type="password" class="form-control" name="password1" required>
      </div>
      <div class="col mb-3">
        <label>Confirm Password</label>
        <input type="password" class="form-control" name="password2" required>
      </div>
    </div>

    <!-- Role -->
    <div class="mb-3">
      <label>Role</label>
      <select class="form-select" id="role-select" name="role" required>
        <option value="">Select role</option>
        <option value="patient" {% if form_data.role=='patient' %}selected{% endif %}>Patient</option>
        <option value="doctor" {% if form_data.role=='doctor' %}selected{% endif %}>Doctor</option>
      </select>
    </div>

    <!-- Doctor Extra Fields -->
    <div id="doctor-extra-fields" style="display:none;">
      <div class="mb-3">
        <label>Degree</label>
        <input type="text" class="form-control" name="degree" placeholder="e.g. MBBS, BDS">
      </div>
      <div class="mb-3">
        <label>Specialization</label>
        <input type="text" class="form-control" name="specialization" placeholder="e.g. Orthodontist">
      </div>
      <div class="mb-3">
        <label>Experience (Years)</label>
        <input type="number" class="form-control" name="experience_years" placeholder="e.g. 5">
      </div>
      <div class="mb-3">
        <label>Bio</label>
        <textarea class="form-control" name="bio" rows="3" placeholder="Write a short bio"></textarea>
      </div>
      <div class="mb-3">
        <label>Profile Picture</label>
        <input type="file" class="form-control" name="profile_picture" accept="image/*">
      </div>
      <div class="mb-3">
        <label>Identity Document</label>
        <input type="file" class="form-control" name="identity_document">
      </div>
    </div>

    <!-- Register Button -->
    <button class="btn btn-primary w-100 py-2 shadow-sm" style="border-radius: 8px;">Register</button>
  </form>
</div>

<!-- JS to show/hide doctor extra fields -->
<script>
const roleSelect = document.getElementById('role-select');
const doctorExtraFields = document.getElementById('doctor-extra-fields');

function toggleDoctorFields() {
    if(roleSelect.value === 'doctor'){
        doctorExtraFields.style.display = 'block';
    } else {
        doctorExtraFields.style.display = 'none';
    }
}
roleSelect.addEventListener('change', toggleDoctorFields);
window.addEventListener('DOMContentLoaded', toggleDoctorFields);
</script>

<!-- Optional: add your validation script here if needed -->

<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap');

body { font-family: 'Poppins', sans-serif; min-height: 100vh; }

.card {
  background: #FFFDF7;
  border: 1px solid #001026;
  border-radius: 14px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.06);
  padding: 25px 30px;
  transition: all 0.3s ease;
}
.card:hover { box-shadow: 0 6px 18px rgba(0,0,0,0.1); transform: translateY(-2px); }

label { color: #0d6efd; font-size: 15px; font-weight:400; }
input, select, textarea {
  border-radius: 8px !important;
  font-size: 0.95rem;
  padding: 10px;
  border: 1px solid #ced4da;
}
input:focus, select:focus, textarea:focus {
  box-shadow: 0 0 6px rgba(13,110,253,0.4);
  border-color: #0d6efd;
}
.btn-primary {
  background-color: #0d6efd;
  border: none;
  letter-spacing: 0.5px;
  border-radius: 8px;
  transition: all 0.3s ease;
}
.btn-primary:hover { background-color: #0b5ed7 !important; transform: translateY(-2px); }

</style>
{% endblock %}
