
{% extends "users/base.html" %}
{% block title %}My Appointments{% endblock %}

{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">

<div class="container mt-4" style="animation: fadeInDown 1s ease-out;">

  <!-- Page Title -->
  <h3 style="margin:0; font-weight:600; font-family:'Montserrat',sans-serif; color:#002852;">My Appointments</h3>
  <p style="margin:5px 0 20px; font-size:17px; opacity:0.85; color:#550073;">
    View, manage, and track your dental appointments below.
  </p>

  <!-- Messages -->
  {% if messages %}
    {% for message in messages %}
      <div style="background-color:#d4edda; color:#155724; border:1px solid #c3e6cb; border-radius:8px; padding:10px 15px; margin-top:15px; box-shadow:0 2px 6px rgba(0,0,0,0.1);">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <!-- ===================== CURRENT / UPCOMING ===================== -->
  <div class="section-card always-open" style="background:white; border-radius:12px; box-shadow:0 4px 14px rgba(0,0,0,0.1); margin-top:10px;">
    <div class="section-header" style="padding:20px; background:linear-gradient(135deg,#003366,#0056b3); color:white; border-radius:12px 12px 0 0;">
      <h4 style="font-weight:600; margin:0;">Current / Upcoming Appointments</h4>
    </div>

    <div class="section-content">
      <table class="table table-striped" style="width:100%; text-align:center; border-radius:12px; overflow:hidden;">
        <thead>
          <tr style="background-color:#002e5e; color:white; font-weight:600;">
            <th>Doctor</th>
            <th>Date & Time</th>
            <th>Payment Status</th>
            <th>Reschedule</th>
          </tr>
        </thead>
        <tbody>
          {% for appt in pending_appointments %}
          <tr>
            <td>{{ appt.doctor.user.get_full_name }}</td>
            <td>{{ appt.date|date:"l, F j, Y, g:i A" }}</td>
            <td>
              {% if appt.payment_status == "Paid" %}
                <span style="background-color:#d4edda;color:#155724;padding:4px 10px;border-radius:6px;font-weight:500;">Paid</span>
              {% else %}
                <a href="{% url 'appointments:esewa_payment_page' appt.id %}" style="background-color:#28a745;color:white;padding:5px 10px;border-radius:6px;text-decoration:none;font-size:0.9rem;">eSewa</a>
                <a href="{% url 'appointments:mock_payment' appt.id %}" style="background-color:#ffc107;color:#000;padding:5px 10px;border-radius:6px;text-decoration:none;font-size:0.9rem;">Mock</a>
              {% endif %}
            </td>
            <td>
              {% if appt.reschedule_label %}
                <span class="{{ appt.reschedule_class }}" style="{{ appt.reschedule_style }}">{{ appt.reschedule_label }}</span>
              {% else %}
                <a href="{% url 'appointments:reschedule_request' appt.id %}" style="background-color:#5a2d8c;color:white;padding:5px 10px;border-radius:6px;text-decoration:none;font-size:0.9rem;">Reschedule</a>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="4" style="text-align:center;color:#6c757d;">No current appointments.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- ===================== COMPLETED ===================== -->
  <div class="section-card" style="background:white; border-radius:12px; box-shadow:0 4px 14px rgba(0,0,0,0.1); margin-top:30px;">
    <div class="section-header" style="padding:20px; cursor:pointer; background:linear-gradient(135deg,#2e7d32,#66bb6a); color:white; border-radius:12px 12px 0 0;">
      <h4 style="font-weight:600; margin:0;">Completed Appointments</h4>
      <p style="margin:4px 0 0; font-size:0.9rem; opacity:0.9;">Hover to review your completed appointments.</p>
    </div>

    <div class="section-content">
      <table class="table table-striped" style="width:100%; text-align:center; border-radius:12px; overflow:hidden;">
        <thead>
          <tr style="background-color:#2e7d32; color:white; font-weight:600;">
            <th>Doctor</th>
            <th>Date & Time</th>
            <th>Status</th>
            <th>Report</th>
          </tr>
        </thead>
        <tbody>
          {% for appt in completed_appointments %}
          <tr>
            <td>{{ appt.doctor.user.get_full_name }}</td>
            <td>{{ appt.date|date:"l, F j, Y, g:i A" }}</td>
            <td><span class="completed">Completed</span></td>
            <td>
              {% if appt.report %}
                <a href="{% url 'appointments:report_detail' appt.id %}" style="background-color:#28a745;color:white;padding:5px 10px;border-radius:6px;text-decoration:none;font-size:0.9rem;">View</a>
              {% else %}
                <span style="color:#6c757d;">Not Available</span>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="4" style="text-align:center;color:#6c757d;">No completed appointments.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- ===================== CANCELLED ===================== -->
  <div class="section-card" style="background:white; border-radius:12px; box-shadow:0 4px 14px rgba(0,0,0,0.1); margin-top:30px;">
    <div class="section-header" style="padding:20px; cursor:pointer; background:linear-gradient(135deg,#661414,#a71d2a); color:white; border-radius:12px 12px 0 0;">
      <h4 style="font-weight:600; margin:0;">Cancelled Appointments</h4>
      <p style="margin:4px 0 0; font-size:0.9rem; opacity:0.9;">Hover to review your cancelled appointments.</p>
    </div>

    <div class="section-content">
      <table class="table table-striped" style="width:100%; text-align:center; border-radius:12px; overflow:hidden;">
        <thead>
          <tr style="background-color:#661414; color:white; font-weight:600;">
            <th>Doctor</th>
            <th>Date & Time</th>
            <th>Status</th>
            <th>Report</th>
          </tr>
        </thead>
        <tbody>
          {% for appt in cancelled_appointments %}
          <tr>
            <td>{{ appt.doctor.user.get_full_name }}</td>
            <td>{{ appt.date|date:"l, F j, Y, g:i A" }}</td>
            <td><span class="cancelled">Cancelled</span></td>
            <td><span style="color:#6c757d;">Not Applicable</span></td>
          </tr>
          {% empty %}
          <tr><td colspan="4" style="text-align:center;color:#6c757d;">No cancelled appointments.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>

<!-- ===================== CSS ===================== -->
<style>
.section-content {
  max-height: 0;
  overflow: hidden;
  opacity: 0;
  transition: all 0.6s ease;
  padding: 0 20px;
}

/* Hover effect for Completed & Cancelled */
.section-card:not(.always-open):hover .section-content {
  max-height: 1000px;
  opacity: 1;
  padding: 20px;
  transition: all 0.6s ease-in-out;
}

/* Always show Current appointments */
.section-card.always-open .section-content {
  max-height: 1000px;
  opacity: 1;
  padding: 20px;
}

/* Header hover */
.section-header:hover {
  filter: brightness(1.1);
  transform: scale(1.01);
  transition: all 0.3s ease;
}

/* Table styling */
.table {
  border-collapse: separate !important;
  border-spacing: 0 10px;
  width: 100%;
  font-family: 'Montserrat', sans-serif;
}
.table tbody tr {
  background-color:#ffffff;
  border-radius:10px;
  transition: all 0.3s ease;
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
}
.table tbody tr td {
  padding:10px 12px;
  font-size:0.92rem;
  font-weight:500;
}
.table tbody tr:hover {
  transform: translateY(-3px);
  box-shadow:0 6px 18px rgba(0,0,0,0.15);
}

/* Status badges */
span.completed {
  background-color:#d4edda; color:#155724; padding:4px 10px; border-radius:6px;
}
span.cancelled {
  background-color:#f8d7da; color:#721c24; padding:4px 10px; border-radius:6px;
}
</style>

{% endblock %}
