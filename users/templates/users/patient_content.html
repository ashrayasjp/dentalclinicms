{% load static %}
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">

<div class="container mt-4" style="animation: fadeInDown 1s ease-out;">

  <!-- Messages -->
  {% if messages %}
    {% for message in messages %}
      <div style="background-color:#d4edda; color:#155724; border:1px solid #c3e6cb; border-radius:8px; padding:10px 15px; margin-top:15px; box-shadow:0 2px 6px rgba(0,0,0,0.1);">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <!-- ===================== CURRENT / UPCOMING ===================== -->
  <div class="section-card always-open" style="background:white; border-radius:12px; box-shadow:0 4px 14px rgba(0,0,0,0.1); margin-top:10px;">
    <div class="section-header" style="padding:20px; background:linear-gradient(135deg,#003366,#0056b3); color:white; border-radius:12px 12px 0 0;">
      <h4 style="font-weight:600; margin:0;">Current / Upcoming Appointments</h4>
    </div>
    <div class="section-content">
        <table class="table table-striped" style="width:100%; text-align:center; border-radius:12px; overflow:hidden;">
            <thead>
                <tr style="background-color:#002e5e; color:white; font-weight:600;">
                    <th>Date & Time</th>
                    <th>Payment Status</th>
                    <th>Reschedule</th>
                </tr>
            </thead>
            <tbody>
                {% for appt in pending_appointments %}
                    {% if appt.doctor == user.doctor %}
                        <tr>
                            <td>{{ appt.date|date:"l, F j, Y, g:i A" }}</td>
                            <td>
                                {% if appt.payment_status == "Paid" %}
                                    <span class="badge-paid">Paid</span>
                                {% else %}
                                    <span class="badge-unpaid">Pending</span>
                                {% endif %}
                            </td>
                            <td>
                                <button class="btn btn-sm btn-secondary" onclick="alert('Reschedule request is not allowed for doctors')">
                                    Reschedule
                                </button>
                            </td>
                        </tr>
                    {% endif %}
                {% empty %}
                    <tr>
                        <td colspan="3" style="text-align:center; color:#6c757d; padding:16px; font-weight:500;">
                            No upcoming appointments.
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    
      
  </div>

  <!-- ===================== COMPLETED ===================== -->
  <div class="section-card" style="background:white; border-radius:12px; box-shadow:0 4px 14px rgba(0,0,0,0.1); margin-top:30px;">
    <div class="section-header" style="padding:20px; cursor:pointer; background:linear-gradient(135deg,#2e7d32,#66bb6a); color:white; border-radius:12px 12px 0 0;">
      <h4 style="font-weight:600; margin:0;">Completed Appointments</h4>
      <p style="margin:4px 0 0; font-size:0.9rem; opacity:0.9;">Hover to review your completed appointments.</p>
    </div>
    <div class="section-content">
      <table class="table table-striped" style="width:100%; text-align:center; border-radius:12px; overflow:hidden;">
        {% if completed_appointments|length > 0 %}
        <thead>
          <tr style="background-color:#2e7d32; color:white; font-weight:600;">
            <th>Date & Time</th>
            <th>Status</th>
            <th>Report</th>
          </tr>
        </thead>
        <tbody>
          {% for appt in completed_appointments %}
            {% if appt.doctor == user.doctor %}
            <tr>
              <td>{{ appt.date|date:"l, F j, Y, g:i A" }}</td>
              <td><span class="completed">Completed</span></td>
              <td>
                {% if appt.report %}
                  <a href="{% url 'appointments:report_detail' appt.id %}" class="btn btn-success btn-sm">View</a>
                {% else %}
                  <span style="color:#6c757d;">Not Available</span>
                {% endif %}
              </td>
            </tr>
            {% endif %}
          {% endfor %}
        </tbody>
        {% else %}
        <tbody>
          <tr>
            <td colspan="3" style="text-align:center; color:#6c757d; padding:15px;">No appointments.</td>
          </tr>
        </tbody>
        {% endif %}
      </table>
    </div>
  </div>

  <!-- ===================== CANCELLED ===================== -->
  <div class="section-card" style="background:white; border-radius:12px; box-shadow:0 4px 14px rgba(0,0,0,0.1); margin-top:30px;">
    <div class="section-header" style="padding:20px; cursor:pointer; background:linear-gradient(135deg,#661414,#a71d2a); color:white; border-radius:12px 12px 0 0;">
      <h4 style="font-weight:600; margin:0;">Cancelled Appointments</h4>
      <p style="margin:4px 0 0; font-size:0.9rem; opacity:0.9;">Hover to review your cancelled appointments.</p>
    </div>
    <div class="section-content">
      <table class="table table-striped" style="width:100%; text-align:center; border-radius:12px; overflow:hidden;">
        {% if cancelled_appointments|length > 0 %}
        <thead>
          <tr style="background-color:#661414; color:white; font-weight:600;">
            <th>Date & Time</th>
            <th>Status</th>
            <th>Report</th>
          </tr>
        </thead>
        <tbody>
          {% for appt in cancelled_appointments %}
            {% if appt.doctor == user.doctor %}
            <tr>
              <td>{{ appt.date|date:"l, F j, Y, g:i A" }}</td>
              <td><span class="cancelled">Cancelled</span></td>
              <td><span style="color:#6c757d;">Not Applicable</span></td>
            </tr>
            {% endif %}
          {% endfor %}
        </tbody>
        {% else %}
        <tbody>
          <tr>
            <td colspan="3" style="text-align:center; color:#6c757d; padding:15px;">No appointments.</td>
          </tr>
        </tbody>
        {% endif %}
      </table>
    </div>
  </div>

<style>
.section-content {max-height:0; overflow:hidden; opacity:0; transition: all 0.6s ease; padding:0 20px;}
.section-card.always-open .section-content {max-height:1000px; opacity:1; padding:20px;}
.section-card:not(.always-open):hover .section-content {max-height:1000px; opacity:1; padding:20px; transition: all 0.6s ease-in-out;}
.section-card {margin-top:20px; border-radius:12px; box-shadow:0 4px 14px rgba(0,0,0,0.1);}
.section-header {padding:20px; color:white; border-radius:12px 12px 0 0;}
.section-header:hover {filter: brightness(1.1); transform: scale(1.01); transition: all 0.3s ease;}
.table {border-collapse: separate !important; border-spacing:0 10px; width:100%; font-family:'Montserrat', sans-serif;}
.table tbody tr {background:#fff; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.08); transition: all 0.3s ease;}
.table tbody tr td {padding:10px 12px; font-size:0.92rem; font-weight:500;}
.table tbody tr:hover {transform: translateY(-3px); box-shadow:0 6px 18px rgba(0,0,0,0.15);}
.badge-paid {background:#d4edda; color:#155724; padding:4px 10px; border-radius:6px;}
.badge-unpaid {background:#ffc107; color:#000; padding:4px 10px; border-radius:6px;}
span.completed {background:#d4edda; color:#155724; padding:4px 10px; border-radius:6px;}
span.cancelled {background:#f8d7da; color:#721c24; padding:4px 10px; border-radius:6px;}
</style>
